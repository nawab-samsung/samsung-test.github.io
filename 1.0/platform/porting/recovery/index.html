<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon"  href="/favicon.ico" />
<title>System Recovery</title>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<base id="baseURL" href="/1.0/" />
<meta id="docsVersion" content="" />
<meta name="last-modified" content="2019-11-03 15:35:21 +0530" />
<meta http-equiv="cache-control" content="max-age=24" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="Cache-Control" content="no-store" />
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="Expires" content="600" />

<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/styles.css?v=03112019">

<script type="text/javascript" src="/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/common.js?v=03112019"></script>
<script type="text/javascript" src="/js/handlebars-v4.0.11.js?v=03112019"></script>
<script type="text/javascript" src="/js/widgets-data.js?v=03112019"></script>
<script type="text/javascript" src="/js/widgets.js?v=03112019"></script>
<script type="text/javascript" src="/js/toc.js"></script>

<script type="module" src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule="" src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons/ionicons.js"></script>

</head>
<body>
    <div class="scroller">
        <header class="navbar-wrapper header">
    <nav class="navbar navbar-default navbar-static-top navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <ion-icon name="menu"></ion-icon>
                </button>
                <a class="navbar-brand active open" href="/">
                    <span class="brand-tizen"><img src="/images/logo.png" alt="logo"></span>
                    <span class="brand-docs">Docs</span>
                </a>
            </div>
            <ul id="navbar" class="nav navbar-nav navbar-right navbar-collapse collapse">
                <li>
                    <a href="platform/about/tizen-open-source-overview">Platform</a>
                </li>
                <li>
                    <a href="application/">Application</a>
                </li>
                <li>
                    <a href="iot/">IoT</a>
                </li>
                <li>
                    <a href="https://developer.tizen.org/development/tizen-studio/download" target="_blank">Download</a>
                </li>
            </ul>
            <form action="/search.html" method="get" class="search-box">
                <div class="input-group">
                    <input type="search" name="q" placeholder="Search ..." autofocus="off" class="form-control">
                    <div class="input-group-btn">
                        <button type="submit" onclick="submitSearch()" title="Search" class="btn btn-default">
                            <ion-icon name="search"></ion-icon>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </nav>
</header>
		<main>
        <div class="landing-tizen">
            <div class="container">
                <div class="row body-cover">
                    


    
    <ul class="nav side-menu">
        <div id="widgetVersionSwitcher"></div>
        
        
        
        
    
        <li class="">
            <a href="platform/about/work-flow" class="hasChild">
                Platform Overview
                <span class="arrow"></span>
            </a>
            
            <ul class="td-tocs depth-1">
                
                <li>
                    
                    
                    <a href="platform/about/work-flow" class="">
                        Platform Development Workflow
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a href="platform/about/git-repo-structure" class="">
                        Platform Git Repository Structure
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a href="platform/about/conventions" class="">
                        Typographic Conventions
                    </a>
                    
                </li>
                
            </ul>
            
        </li>
    
        
        
        
    
        <li class="">
            <a href="platform/developing/installing" class="hasChild">
                Platform Developing
                <span class="arrow"></span>
            </a>
            
            <ul class="td-tocs depth-1">
                
                <li>
                    
                    
                    <a href="platform/developing/installing" class="">
                        Installing Development Tools
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a href="platform/developing/setting-up" class="">
                        Setting up Development Environment
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a href="platform/developing/cloning" class="">
                        Cloning Tizen Source Files
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a href="platform/developing/building" class="">
                        Building Packages Locally with GBS
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a href="platform/developing/building-all" class="">
                        Building All Packages Locally with GBS
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a href="platform/developing/contributing" class="">
                        Contributing Code to Tizen
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a href="platform/developing/creating" class="">
                        Creating Tizen Images with MIC
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a href="platform/developing/flashing" class="">
                        Flashing an Image to Device
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a href="platform/developing/tips" class="">
                        Development Tips
                    </a>
                    
                </li>
                
            </ul>
            
        </li>
    
        
        
        
    
        <li class="open">
            <a href="platform/porting/overview" class="hasChild">
                Porting
                <span class="arrow"></span>
            </a>
            
            <ul class="td-tocs depth-1">
                
                <li>
                    
                    
                    <a href="platform/porting/overview" class="">
                        Overview
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a href="platform/porting/kernel" class="">
                        Kernel
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a href="platform/porting/system" class="">
                        System
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a href="platform/porting/graphics-and-ui" class="">
                        Graphics and UI
                    </a>
                    
                </li>
                
            </ul>
            
        </li>
    
        
        
        
    
        <li class="">
            <a href="platform/reference/gerrit-usage" class="hasChild">
                Reference
                <span class="arrow"></span>
            </a>
            
            <ul class="td-tocs depth-1">
                
                <li>
                    
                    
                    <a href="platform/reference/gerrit-usage" class="">
                        Gerrit
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a href="platform/reference/gbs/gbs-overview"
                        class="hasChild ">
                        Git Build System (GBS)
                        <span class="arrow"></span>
                    </a>
                    <ul class="td-tocs depth-2 ">
                        
                        <li>
                            
                            <a href="platform/reference/gbs/gbs-overview"
                                class="">
                                Overview
                            </a>
                        </li>
                        
                        <li>
                            
                            <a href="platform/reference/gbs/gbs.conf"
                                class="">
                                GBS Configuration
                            </a>
                        </li>
                        
                        <li>
                            
                            <a href="platform/reference/gbs/gbs-maintenance-models"
                                class="">
                                GBS Maintenance Models
                            </a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    
                    
                    <a href="platform/reference/mic/mic-overview"
                        class="hasChild ">
                        MIC Image Creator
                        <span class="arrow"></span>
                    </a>
                    <ul class="td-tocs depth-2 ">
                        
                        <li>
                            
                            <a href="platform/reference/mic/mic-overview"
                                class="">
                                Overview
                            </a>
                        </li>
                        
                        <li>
                            
                            <a href="platform/reference/mic/mic-customize-image"
                                class="">
                                Customizing Images
                            </a>
                        </li>
                        
                        <li>
                            
                            <a href="platform/reference/mic/mic-reference"
                                class="">
                                MIC Reference
                            </a>
                        </li>
                        
                    </ul>
                    
                </li>
                
            </ul>
            
        </li>
    
        
        
    </ul>


<script>
    $("a[href$='/platform/porting/recovery/']").addClass("active open");
</script>
                    <div class="body" id="printableArea">
                        <div class="text-right">
                            <button class="print-btn hidden-print" onclick="printDiv('printableArea')">PRINT</button>
                        </div>
                        <div class="widgetLatestVersionNotification"></div>
                        <h1 id="system-recovery">System Recovery</h1>

<p>Tizen 4.0 comes with 3 different root filesystems, each designed for a different purpose.</p>

<p><strong>Table: Root filesystems</strong></p>

<table>
  <thead>
    <tr>
      <th>Label</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>rootfs</code></td>
      <td>Main root filesystem</td>
    </tr>
    <tr>
      <td><code>ramdisk</code></td>
      <td>Regular boot ramdisk</td>
    </tr>
    <tr>
      <td><code>ramdisk-recovery</code></td>
      <td>System recovery ramdisk</td>
    </tr>
  </tbody>
</table>

<p>This topic describes operation and customization options of the system
recovery ramdisk.</p>

<p>The following steps describe the boot process:</p>

<ol>
  <li>
    <p>The boot process starts with a bootloader (u-boot or s-boot) loading
appropriate kernel and ramdisk images dedicated for the system
recovery process (methods for controlling bootloader actions are beyond the
scope of this document). With both images loaded into RAM, the kernel
initialization begins. When the initialization is complete, the kernel passes
control to the init process, such as <code>/sbin/init</code> (PID#1).</p>
  </li>
  <li>
    <p>In the case of the recovery ramdisk, <code>/sbin/init</code> is a symlink to
<code>/usr/libexec/initrd-recovery/init</code> (a shell script that comes
from the <code>initrd-recovery</code> package). The script mounts several kernel
filesystems and the inform partition (if it exists), and parses the
kernel command line options (<code>/proc/cmdline</code>) to find the <code>bootmode</code>
parameter. If the parameter is present, one of the <code>/sbin/*-init</code> scripts is
started. If the boot mode is set to <code>recovery</code>,
<code>/usr/libexec/system-recovery/recovery-init</code> is started.</p>
  </li>
  <li>
    <p>The <code>recovery-init</code> script mounts the real root filesystem under
the <code>/system</code> directory, and other filesystems (such as <code>/opt</code> and
<code>/opt/usr</code>) below the <code>/system</code> directory. The script starts a shell on the serial console and launches the
<code>system-recovery</code> program.</p>
  </li>
  <li>
    <p>The <code>system-recovery</code> program can work as either an interactive GUI or
a non-interactive dispatcher, executing 1 (non-interactive) or
more (interactive) actions. The actions are configured in the
<code>/usr/share/system-recovery/system-recovery.cfg</code> file.</p>
  </li>
</ol>

<h2 id="configuration-file">Configuration File</h2>

<p>The configuration file allows you to customize 2 aspects of
the system-recovery operation: GUI and actions. The following sections take a closer look
at the actions.</p>

<p>The configuration file is parsed using <code>libconfig</code>. For a detailed description of the
grammar, see the <a href="http://hyperrealm.com/libconfig/libconfig_manual.html#Configuration-File-Grammar">libconfig documentation</a>.</p>

<h3 id="action_handlers"><code>action_handlers</code></h3>

<p><code>action_handlers</code> is a dictionary, in which shell commands (action
handlers) are assigned names (actions). The names are used later in
the configuration to refer to commands. The dictionary can be edited
and actions can be added or removed. The names must be unique.</p>

<pre><code>action_handlers = {
    reboot = "reboot -f";
    factory-reset = "touch -f /opt/.factoryreset";
    safeboot = "touch -f /opt/etc/.safeboot";
}
</code></pre>

<h3 id="menus"><code>menus</code></h3>

<p>Actions (names) are used in the <code>menus</code> dictionary, which
comprises all pages of the menu system presented by
<code>system-recovery</code>. The <code>main</code> entry is the one the program displays
at startup. The rest must be linked in a tree-like structure.</p>

<p>Each menu entry consists of the following fields:</p>

<ul>
  <li><code>pos_x</code> and <code>pox_y</code>: Position on a screen</li>
  <li><code>style</code>: Reference to the <code>menu_styles</code> dictionary</li>
  <li><code>actions</code>: Array of actions available in this menu</li>
  <li><code>item_default</code>: Action to highlight when opening the menu</li>
</ul>

<p>The <code>system-recovery</code> program can handle an action in 2 ways: it can run an action handler
or switch to another screen. There is a reserved screen name <strong>BACK</strong>, which
means switching to the previous screen (for more information, see <code>screen_back</code> in the <a href="#screens">screens
dictionary</a>).</p>

<pre><code>menus = {
    main = {
        pos_x = 0;
        pos_y = 100;
        style = "common";
        actions = ({
            label = "Reboot system now";
            screen_switch_to = "reboot";
        },{
            label = "Safe mode";
            screen_switch_to = "safe";
        },{
            label = "Phone reinitialisation";
            screen_switch_to = "factory";
        });
    };
    reboot = {
        pos_x = 0;
        pos_y = 480;
        style = "common";
        item_default = 1;
        actions = ({
            label = "Yes";
            action_handler = "reboot";
            exit_after_action = 0;
        },{
            label = "No";
            screen_switch_to = "BACK";
        });
    };
    safe = {
        pos_x = 0;
        pos_y = 480;
        style = "common";
        item_default = 1;
        actions = ({
            label = "Yes";
            action_handler = "safeboot";
            exit_after_action = 1;
        },{
            label = "No";
            screen_switch_to = "BACK";
        });
    };
    factory = {
        pos_x = 0;
        pos_y = 480;
        style = "common";
        item_default = 1;
        actions = ({
            label = "Yes";
            screen_switch_to = "factory-run";
            action_handler = "factory-reset";
            exit_after_action = 1;
        },{
            label = "No";
            screen_switch_to = "BACK";
        });
    };
};
</code></pre>

<blockquote>
  <p><strong>Note</strong></p>

  <p>The <code>system-recovery.cfg.m4.in</code> source file provides the <code>confirm_action</code> m4 macro to define a <strong>Yes/No</strong> style action array:</p>
  <ul>
    <li><strong>Yes</strong> executes an action.</li>
    <li><strong>No</strong> switches to a previous screen.</li>
  </ul>

  <p>Use this macro when adding an action to the config file in the repository.</p>

  <p>For example:</p>
  <pre><code>actions = confirm_action('safeboot', 1);
</code></pre>
  <p>Expands to:</p>
  <pre><code>actions = ({
    label = "Yes";
    action_handler = "safeboot";
    exit_after_action = 1;
},{
    label = "No";
    screen_switch_to = "BACK";
});
</code></pre>

  <p>The first argument of the macro is an action, and the second is the value to assign to the <code>exit_after_action</code> element.</p>
</blockquote>

<h3 id="screens"><code>screens</code></h3>

<p>Each action can either execute an action handler (a shell command) or switch to a screen. The screens are configured in
their dictionary as follows:</p>

<pre><code>screens = {
    main = {
        style = "common";
        menu = "main";
        description = "main";
        rulers = "main";
        images = ("background_default", "menu_title");
        screen_back = "CURRENT";
    };
    reboot = {
        style = "common";
        menu = "reboot";
        description = "reboot"
        rulers = "confirm";
        images = ("background_default", "menu_title");
        screen_back = "main";
    };
    safe = {
        style = "common";
        menu = "safe";
        description = "safe";
        rulers = "confirm";
        images = ("background_default", "menu_title");
        screen_back = "main";
    };
    factory = {
        style = "common";
        menu = "factory";
        description = "factory";
        rulers = "confirm";
        images = ("background_default", "menu_title");
        screen_back = "main";
    };
    factory-run = {
        style = "common";
        description = "factory-run";
        rulers = "confirm";
        images = ("background_default", "menu_title");
        animations = ("working");
        screen_back = "main";
        allow_force_reboot = 1;
    };
};
</code></pre>

<p>The above entries contain 2 parameter groups:</p>

<ul>
  <li>The first group is responsible for the look of a screen:
    <ul>
      <li><code>style</code>: Element of the <code>screen_styles</code> dictionary</li>
      <li><code>rulers</code>: Element of the <code>rulers</code> dictionary</li>
      <li><code>images</code>: List of elements of the <code>images</code> dictionary</li>
      <li><code>animations</code>: Element of the <code>animations</code> dictionary</li>
    </ul>

    <p>These parameters are not described in detail in this document.</p>
  </li>
  <li>The second group comprises parameters that describe logic:
    <ul>
      <li><code>menu</code>: Menu to display (an element of the <code>menus</code> dictionary)</li>
      <li><code>description</code>: Description text and screen title to display (an element of the <code>descriptions</code> dictionary)</li>
      <li><code>screen_back</code>: Screen to switch to when switching <strong>BACK</strong></li>
      <li><code>allow_force_reboot</code>: Reboot after executing an action</li>
    </ul>
  </li>
</ul>

<h3 id="descriptions"><code>descriptions</code></h3>

<p>The elements of the <code>descriptions</code> dictionary hold screen titles and
brief descriptions for screen entries:</p>

<ul>
  <li><code>title</code>: Short (one line) title displayed at the top of a screen</li>
  <li><code>description</code>: Brief explanation of actions available on the screen</li>
</ul>

<pre><code>descriptions = {
    main = {
        pos_x = 15;
        pos_y = 480;
        style = "common";
        title = "Controls:";
        text = "Volume Up/Down to move menu cursor\n"
            "Power button to select";
    };

    reboot = {
        pos_x = 15;
        pos_y = 100;
        title = "The phone will be restarted.";
        text = "Continue?";
        style = "common";
    };

    safe = {
        pos_x = 15;
        pos_y = 100;
        title = "Safe mode:",
        text = "The phone will be started in safe mode.\n"
            "Home screen will be changed to default\n"
            "setting and just allow a user to use\n"
            "only preloaded applications.\n"
            "Continue?";
        style = "common";
    };

    factory = {
        pos_x = 15;
        pos_y = 100;
        title = "Factory reset (except SD-card)";
        text = "This will erase all data from your\n"
            "phone's internal storage, including\n"
            "settings of downloaded and preloaded\n"
            "applications and system configuration.\n"
            "Continue?";
        style = "common";
    };

    factory-run = {
        pos_x = 15;
        pos_y = 100;
        style = "common";
        title = "Restoring settings to factory default.";
        text = "Please wait. Do not turn off.\n"
            "(Hold power button for 3 seconds\n"
            "to reboot the device. Not recommended.)";
    }
};
</code></pre>

<h2 id="non-interactive-operation">Non-interactive Operation</h2>

<p>If the <code>system-recovery</code> program is compiled without GUI support, only 2 parameters
in the configuration file control how the program behaves:</p>

<ul>
  <li><code>action_handlers</code>: List of shell commands</li>
  <li><code>headless_action</code>: Action to execute by default</li>
</ul>

<p>Before <code>system-recovery</code> reads the <code>headless_action</code> parameter, it looks
for the action to execute in 2 other places:</p>

<ul>
  <li><code>tizen.recovery</code> kernel command line option (such as <code>tizen.recovery=factory-reset</code>)</li>
  <li><code>/opt/.recovery.action</code></li>
</ul>

<pre><code>headless_action = "factory-reset";
</code></pre>

<h2 id="adding-new-actions">Adding New Actions</h2>

<p>To add a new action:</p>

<ol>
  <li>Define an action handler in the <code>action_handlers</code> dictionary:
    <pre><code>action_handlers = {
    factory-reset-minimal = "/usr/bin/factory-reset-minimal.sh"
};
</code></pre>
  </li>
  <li>Take the <code>factory</code> entry from the <code>menus</code> dictionary and adapt it:
    <pre><code>menus = {
    factory-minimal = {
        pos_x = 0;
        pos_y = 480;
        style = "common";
        item_default = 1;
        actions = ({
            label = "Yes";
            screen_switch_to = "factory-run-minimal";
            action_handler = "factory-reset-minimal";
            exit_after_action = 1;
        },{
            label = "No";
            screen_switch_to = "BACK";
        });
    };
};
</code></pre>
  </li>
  <li>Add 2 new entries in the <code>screens</code> dictionary:
    <pre><code>screens = {
    factory-minimal = {
        style = "common";
        menu = "factory-minimal";
        description = "factory-minimal";
        rulers = "confirm";
        images = ("background_default", "menu_title");
        screen_back = "main";
    };
    factory-run-minimal = {
        style = "common";
        description = "factory-run-minimal";
        rulers = "confirm";
        images = ("background_default", "menu_title");
        animations = ("working");
        screen_back = "main";
        allow_force_reboot = 1;
    };
};
</code></pre>
  </li>
  <li>Add 2 new entries in the <code>descriptions</code> dictionary:
    <pre><code>descriptions = {
    factory-minimal = {
        pos_x = 15;
        pos_y = 100;
        title = "Factory reset (except SD-card)";
        text = "This will erase SOME data from your\n"
            "phone's internal storage, including\n"
            "settings of downloaded and preloaded\n"
            "applications and system configuration.\n"
            "Continue?";
        style = "common";
    };
    factory-run-minimal = {
        pos_x = 15;
        pos_y = 100;
        style = "common";
        title = "Restoring SOME settings to factory default.";
        text = "Please wait. Do not turn off.\n"
            "(Hold power button for 3 seconds\n"
            "to reboot the device. Not recommended.)";
    };
};
</code></pre>
  </li>
  <li>Add an action to the <code>main</code> menu that switches to the <code>factory-minimal</code> screen:
    <pre><code>main = {
    pos_x = 0;
    pos_y = 100;
    style = "common";
    actions = ({
        label = "Reboot system now";
        screen_switch_to = "reboot";
    },{
        label = "Safe mode";
        screen_switch_to = "safe";
    },{
        label = "Phone reinitialisation";
        screen_switch_to = "factory";
    },{
        label = "Minimal phone reinitialisation";
        screen_switch_to = "factory-minimal";
    });
};
</code></pre>
  </li>
</ol>

<h2 id="look-and-feel-options">Look-and-feel Options</h2>

<p>The following example shows the remaining parts of the configuration file, containing options that control the look-and-feel of the system recovery menus:</p>

<pre><code>colors = {
    background = "#000000ff";
    title = "#1bc7ccff";
    ruler = "#1bc7ccff";
    white = "#ffffffff";
};

ruler_styles = {
    common = {
        c_ruler = "ruler";
    };
};

menu_styles = {
    common = {
        item_height = 80;
        item_spacing = 8;
        text_pos_x = 15;
        c_bg_selected = "title";
        c_bg_unselected = "background";
        c_text_selected = "white";
        c_text_unselected = "white";
    };
};

screen_styles = {
    common = {
        c_background = "background";
    };
};

description_styles = {
    common = {
        c_title = "title";
        c_text = "white";
    };
};

rulers = {
    main = (
    {
        pos_x = 0;
        pos_y = 80;
        height = 2;
        style = "common";
    }, {
        pos_x = 0;
        pos_y = 420;
        height = 2;
        style = "common";
    });

    confirm = (
    {
        pos_x = 0;
        pos_y = 80;
        height = 2;
        style = "common";
    });
};

images = {
    background_default = {
        fname = "/usr/share/system-recovery/res/images/warning.png";
        c_bg = "background"; // reference to colors
        align_hor = "center";
        align_ver = "bottom";
        offset_x = 0;
        offset_y = 0;
        img_type = "alpha"; // alt: "no-alpha";
    };
    menu_title = {
        fname = "/usr/share/system-recovery/res/images/menu-title.png";
        c_bg = "title";
        align_hor = "center";
        align_ver = "top";
        offset_x = 0;
        offset_y = 20;
        img_type = "no-alpha"; // alt: "no-alpha";
    };
};

animations = {
    working = {
        fname = "/usr/share/system-recovery/res/images/tizen-anim.png";
        c_bg = "background";
        align_hor = "center";
        align_ver = "middle";
        offset_x = 0;
        offset_y = 0;
        frames_num = 0;
        current_frame = 0;
        img_type = "no-alpha"; // alt: "no-alpha";
    };
};
</code></pre>

<h2 id="adding-new-files-to-the-ramdisk-recovery-partition">Adding New Files to the <code>ramdisk-recovery</code> Partition</h2>

<p>The <code>ramdisk-recovery</code> partition is created along with the <code>rootfs</code>
partition (methods for creating images are beyond the scope of this
document):</p>

<ul>
  <li>Files to be added to the <code>ramdisk-recovery</code> partition must
be available in Tizen RPM packages.</li>
  <li>Files are added to the partition by the <code>mkinitrd-recovery.sh</code> script, which is started
automatically as a part of the <code>%posttrans</code> RPM script of the <code>initrd-recovery</code> package.</li>
</ul>

<p>To install a selected file in the recovery
image, its RPM needs to be installed before <code>initrd-recovery</code> is run. The
easiest way to make sure this happens is to list the package as a
dependency in the <code>initrd-recovery.spec</code> file.</p>

<p>The <code>mkinitrd-recovery.sh</code> script copies or moves files from the
<code>rootfs</code> partition to the <code>initrd-recovery</code> partition according to
directions provided in configuration files stored in the
<code>/usr/share/initrd-recovery/initrd.list.d</code> directory. These files
must be packaged in the RPM packages together with the
files to be put on the <code>initrd-recovery</code> partition. The configuration files are
interpreted as shell scripts and can be used to set the following
variables:</p>

<ul>
  <li><code>DIRECTORIES</code>: Create directories.</li>
  <li><code>DIR_SYMLINKS</code>: Create symbolic links to directories.</li>
  <li><code>LIBONLYS</code>: Copy <strong>only</strong> the libraries required by the listed executable files.</li>
  <li><code>MVWITHLIBS</code>: Move the listed executable files and copy the required libraries.</li>
  <li><code>SYMLINKS</code>: Create symbolic links.</li>
  <li><code>VERBATIMS</code>: Copy the listed files. List non-executable files here.</li>
  <li><code>WITHLIBS</code>: Copy the listed executable files and the required libraries.</li>
</ul>

<p>The <code>SYMLINKS</code> and <code>DIR_SYMLINKS</code> variables contain pairs of filenames separated with
colons.</p>

<p>The following section contains examples of the above variables:</p>

<pre><code>DIRECTORIES="
/var/tmp
/usr/lib/odbc
"

# LinkFileName:Target
DIR_SYMLINKS="
/lib:usr/lib
/opt:system/opt
"

LIBONLYS="
/bin/bash
/bin/kill
"

MVWITHLIBS="
/usr/libexec/initrd-recovery/minireboot
/usr/libexec/system-recovery/system-recovery.gui
"

WITHLIBS="
/usr/bin/sync
/usr/bin/touch
"

VERBATIMS="
/usr/share/system-recovery/res/images/font.png
/usr/share/system-recovery/res/images/menu-title.png
/usr/share/system-recovery/system-recovery.cfg
"

# LinkFileName:Target
SYMLINKS="
/sbin/recovery-init:/usr/libexec/system-recovery/recovery-init
/usr/lib/bufmgr/libtbm_default.so:libtbm_sprd.so
"
</code></pre>

<p>The following real-world example comes from the <code>initrd-recovery</code>
package. Following this configuration, <code>mkinitrd-recovery.sh</code> copies
some basic tools to the <code>initrd-recovery</code> partition, moves <code>init</code> and
<code>minireboot</code>, and creates some symlinks:</p>

<pre><code>MVWITHLIBS="
/usr/libexec/initrd-recovery/init
/usr/libexec/initrd-recovery/minireboot
"

WITHLIBS="
/usr/bin/bash
/usr/bin/cat
/usr/bin/mkdir
/usr/bin/mount
/usr/bin/sleep
/usr/bin/sync
/usr/bin/umount
/usr/sbin/blkid
"

# LinkFileName:Target
SYMLINKS="
/bin/sh:bash
/sbin/init:/usr/libexec/initrd-recovery/init
/sbin/minireboot:/usr/libexec/initrd-recovery/minireboot
/sbin/reboot:/usr/libexec/initrd-recovery/minireboot
"
</code></pre>

                    </div>
                </div>
            </div>
        </div>
		</main>
        <footer class="footer">
  <div class="family-sites">
    <ul>
      <li>
        <a href="https://developer.tizen.org/" target="_blank">
          Developers
        </a>
      </li>
      <li>
        <a href="https://docs.tizen.org" target="_blank">
          Docs
        </a>
      </li>
      <li>
        <a href="https://dashboard.tizen.org" target="_blank">
          Dashboard
        </a>
      </li>
      <li>
        <a href="https://craftroom.tizen.org/" target="_blank">
          Craftroom
        </a>
      </li>
    </ul>
  </div>
  <div class="outer-links">
    <ul>
      <li>
        <a href="https://twitter.com/TizenProject" target="_blank">
          <ion-icon name="logo-twitter"></ion-icon> Twitter
        </a>
      </li>
      <li>
        <a href="http://www.facebook.com/pages/Tizen-Project" target="_blank">
          <ion-icon name="logo-facebook"></ion-icon> Facebook
        </a>
      </li>
      <li>
        <a href="https://bugs.tizen.org" target="_blank">
          <ion-icon name="bug"></ion-icon> Bug Tracker
        </a>
      </li>
      <li>
        <a href="http://lists.tizen.org" target="_blank">
          <ion-icon name="mail"></ion-icon> Mailing Lists
        </a>
      </li>
      <li>
        <a href="http://www.tizenstore.com" target="_blank">
          <ion-icon name="cart"></ion-icon> Tizen Store
        </a>
      </li>
    </ul>
    </div>
  <div class="copyright">
    © 2019 Tizen Project, a <a href="http://www.linuxfoundation.org/" target="_blank">Linux Foundation</a> Project. All Rights Reserved.
    Linux is a registered trademark of Linus Torvalds.<br>
    Tizen is a registered trademark of The Linux Foundation. * Other names and brands may be claimed as the property of
    others.<br>
    Except as noted, this content is licensed under Creative Commons Attribution 3.0. For details, see the <a
      href="https://www.tizen.org/content-license">Content License.</a><br>
  </div>
</footer>
    </div>
    <div id="templates"></div>    
</body>
</html>
